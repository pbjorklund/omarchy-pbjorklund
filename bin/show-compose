#!/bin/bash
# Display XCompose sequences in a nice format - optimized for speed

set -e

show_compose() {
    echo "=== COMPOSE SEQUENCES ==="
    echo
    echo "Hold TAB + key combinations:"
    echo
    
    echo "ðŸ“¦ Default Omarchy Sequences:"
    # Use grep + awk for much faster parsing
    grep '^<Multi_key>' /home/pbjorklund/.local/share/omarchy/default/xcompose 2>/dev/null | \
    awk -F'"' '
    {
        # Extract keys between < and >
        gsub(/<Multi_key>/, "Tab +")
        gsub(/[<>]/, "")
        split($0, parts, " : ")
        keys = parts[1]
        output = $2
        # Extract comment after #
        if (match($0, /# /)) {
            comment = substr($0, RSTART+2)
        } else {
            comment = ""
        }
        printf "  %-20s â†’ %-8s # %s\n", keys, output, comment
    }'
    
    echo
    echo "ðŸŽ¯ Personal Expansions:"
    if [[ -f "$HOME/.XCompose" ]]; then
        grep '^<Multi_key>' "$HOME/.XCompose" 2>/dev/null | \
        awk -F'"' '
        {
            gsub(/<Multi_key>/, "Tab +")
            gsub(/[<>]/, "")
            split($0, parts, " : ")
            keys = parts[1]
            output = $2
            if (match($0, /# /)) {
                comment = substr($0, RSTART+2)
            } else {
                comment = ""
            }
            printf "  %-20s â†’ %-20s # %s\n", keys, output, comment
        }'
    fi
    
    echo
    echo "Press any key to close..."
    read -n 1 -s
}

# Call the function
show_compose