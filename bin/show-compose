#!/bin/bash
# Display XCompose sequences in a nice format - optimized for speed

set -e

show_compose() {
    echo "=== COMPOSE SEQUENCES ==="
    echo
    echo "Hold TAB + key combinations:"
    echo
    
    echo "ðŸ“¦ Default Omarchy Sequences:"
    # Use grep + awk for much faster parsing
    grep '^<Multi_key>' /home/pbjorklund/.local/share/omarchy/default/xcompose 2>/dev/null | \
    awk -F'"' '
    {
        # Extract keys between < and >
        gsub(/<Multi_key>/, "Tab +")
        gsub(/[<>]/, "")
        split($0, parts, " : ")
        keys = parts[1]
        output = $2
        # Extract comment after #
        if (match($0, /# /)) {
            comment = substr($0, RSTART+2)
        } else {
            comment = ""
        }
        # Truncate long output to 90 chars
        if (length(output) > 90) {
            output = substr(output, 1, 87) "..."
        }
        printf "%s â†’ %s", keys, output
        if (comment != "") printf " # %s", comment
        print ""
    }'
    
    echo
    echo "ðŸŽ¯ Personal Expansions:"
    if [[ -f "$HOME/.XCompose" ]]; then
        grep '^<Multi_key>' "$HOME/.XCompose" 2>/dev/null | \
        awk -F'"' '
        {
            gsub(/<Multi_key>/, "Tab +")
            gsub(/[<>]/, "")
            split($0, parts, " : ")
            keys = parts[1]
            output = $2
            if (match($0, /# /)) {
                comment = substr($0, RSTART+2)
            } else {
                comment = ""
            }
            # Truncate long output to 90 chars
            if (length(output) > 90) {
                output = substr(output, 1, 87) "..."
            }
            printf "%s â†’ %s", keys, output
            if (comment != "") printf " # %s", comment
            print ""
        }'
    fi
    
    echo
    echo "Press any key to close..."
    read -n 1 -s
}

# Call the function
show_compose